<!DOCTYPE html>
<html>
    <head>
        <title>Mapcolonies : Raster: Get Started</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Mapcolonies</a></span>
                            </li>
                                                    <li>
                                <span><a href="Map-Colonies---Cook-Book_1687289909.html">Map Colonies - Cook Book</a></span>
                            </li>
                                                    <li>
                                <span><a href="Getting-Started_1688764533.html">Getting Started</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Mapcolonies : Raster: Get Started
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Alex Lebinson</span>, last modified on Mar 03, 2022
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h2 id="Raster:GetStarted-BestPractices">Best Practices</h2><p>The following guide will help you understand,<em><strong> Step-by-step</strong></em> the best practices of how to work with the Map Colonies Catalog and how to consume mapping products in <em><strong>dynamic way </strong></em>(materials might be changed or added)</p><p>Lets get started…</p><p><strong><u>Step 1:</u></strong></p><p>Query <strong>RASTER CSW catalog</strong> service to find item(s) according to desired filter (<a href="./Query-Examples_1687290406.html" rel="nofollow">example are here</a>)</p><p>Assuming you enquire the desired mapping Product ID from our catalog.</p><p>Query the catalog by the ‘<a href="./Map-Colonies---Catalog-Information_1687290314.html" rel="nofollow">mc:productId</a>’ field to get the product metadata:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: xml; gutter: false; theme: Confluence" data-theme="Confluence">POST Request

url:
&#39;&lt;PYCSW_SERVICE_URL&gt;/csw&#39;

body (XML):
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;csw:GetRecords xmlns:csw=&quot;http://www.opengis.net/cat/csw/2.0.2&quot; service=&quot;CSW&quot; maxRecords=&quot;1&quot;  startPosition=&quot;1&quot;  outputSchema=&quot;http://schema.mapcolonies.com/raster&quot; version=&quot;2.0.2&quot; xmlns:mc=&quot;http://schema.mapcolonies.com/raster&quot; &gt;
  &lt;csw:Query typeNames=&quot;mc:MCRasterRecord&quot;&gt;
   &lt;csw:ElementSetName&gt;full&lt;/csw:ElementSetName&gt;
    &lt;csw:Constraint version=&quot;1.1.0&quot;&gt;
      &lt;Filter xmlns=&quot;http://www.opengis.net/ogc&quot;&gt;
        &lt;PropertyIsLike wildCard=&quot;%&quot; singleChar=&quot;_&quot; escapeChar=&quot;\\&quot;&gt;
          &lt;PropertyName&gt;mc:productId&lt;/PropertyName&gt;
          &lt;!-- ****** INSERT LAYER LAYER ID START ********************** --&gt;
          &lt;Literal&gt;bluemarble_5km&lt;/Literal&gt;
          &lt;!-- ****** INSERT LAYER LAYER ID END ************************ --&gt;
        &lt;/PropertyIsLike&gt;
      &lt;/Filter&gt;
    &lt;/csw:Constraint&gt;
  &lt;/csw:Query&gt;
&lt;/csw:GetRecords&gt;</pre>
</div></div><p>You will get GetRecords XML Response with all the metadata about LAYER product.</p><p>Download my response for example:</p><p /><p class="media-group"><span class="confluence-embedded-file-wrapper"><a class="confluence-embedded-file" href="attachments/1690501187/1690796050.xml" data-nice-type="null" data-file-src="/wiki/download/attachments/1690501187/GetRecordsResponse.xml?version=1&amp;modificationDate=1645696528730&amp;cacheVersion=1&amp;api=v2" data-linked-resource-id="1690796050" data-linked-resource-type="attachment" data-linked-resource-container-id="1690501187" data-linked-resource-default-alias="GetRecordsResponse.xml" data-mime-type="application/xml" data-has-thumbnail="true" data-linked-resource-version="1" data-media-id="1917ff05-0264-41da-80b9-3a4d82a0ccd1" data-media-type="file"><img src="attachments/thumbnails/1690501187/1690796050" height="250"/></a></span></p><p /><hr/><p><strong><u>Step 2:</u></strong></p><p>Now you want to find LAYER product BBOX (aka ‘extent’) from the metadata response of the product.<br/>In the Response, look for <code>&lt;mc:productBBox&gt;&lt;/mc:productBBox&gt;</code> element.<br/>In the example above - response XML file looks like this: <code>&lt;mc:productBBox&gt;-180,-90,180,90&lt;/mc:productBBox&gt;</code></p><p /><p>Another way to find the product extent:<br/>In the Response, look for <code>&lt;mc:footprint&gt;&lt;/mc:footprint&gt;</code> element.<br/>In the example above - response XML file looks like this: <br/><code>&lt;mc:footprint&gt;{&quot;type&quot;:&quot;Polygon&quot;,&quot;coordinates&quot;:[[[-180,-90],[-180,90],[180,90],[180,-90],[-180,-90]]]}&lt;/mc:footprint&gt;</code>)</p><p>Use any tool to convert the footprint into an extent (turf, etc..).<br/>After you’ve got your product BBOX lets move to the next step…</p><hr/><p><strong><u>Step 3:</u></strong></p><p>Now, you need to fetch MapProxy Layer metadata by sending ‘<strong>GetCapabilties</strong>' Request.<br/>You can go to the next URL below with your browser or just send GET request to:</p><p>Example:</p><blockquote><p><strong>&lt;MAPPROXY_SERVICE_URL&gt;/service?REQUEST=GetCapabilities&amp;SERVICE=WMTS</strong></p></blockquote><p>Response will contain the layers' metadata details. Example:</p><span class="confluence-embedded-file-wrapper image-left-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-left" width="442" loading="lazy" src="attachments/1690501187/1690796057.png?width=442" data-image-src="attachments/1690501187/1690796057.png" data-height="305" data-width="613" data-unresolved-comment-count="0" data-linked-resource-id="1690796057" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="GetCabailities_Mapproxy_example.png" data-base-url="wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="1690501187" data-linked-resource-container-version="4" data-media-id="5ff57dda-3e91-4727-b661-31b3732ca765" data-media-type="file"></span><p>Now, all you have to do is <strong>save</strong> the following values in order to consume the layer later on Step 5.<br/>In the Response, look for LAYER product ID (<code>&lt;ows:Identifier</code>)  <br/>In the example it's ‘bluemarble_5km’ as you can see above.</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p><strong>Later in the guide, we will use the field values ​​that appear in the response we received</strong></p></div></div><hr/><p><strong><u>Step 4:</u></strong></p><p>Now, let's put together the WMTS URL for the layer consumption, which appears in the response from previous step:</p><p>There are 2 ways to do this:</p><div id="expander-1380393559" class="expand-container"><div id="expander-control-1380393559" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">1st method</span></div><div id="expander-content-1380393559" class="expand-content"><ol><li><p>Remember the GetRecords XML response that we got from querying our catalog in step 1?</p></li></ol><p> You can look for:</p><p><code>&lt;mc:links scheme=&quot;</code><strong><span style="color: rgb(101,84,192);">WMTS_LAYER</span></strong><code>&quot; name=&quot;bluemarble_5km&quot; description=&quot;&quot;&gt;'&lt;LAYER_MAPPROXY_URL&gt;/wmts/bluemarble_5km/{TileMatrixSet}/{TileMatrix}/{TileCol}/{TileRow}.png'&lt;/mc:links&gt;</code>  element,</p><p>Now all you have to do is just use  <em><strong>&lt;mc:links&gt; </strong></em>element value as is. </p><p>Remember, its just an example, do not use above URL as real URL in order to consume LAYER layer later.</p></div></div><div id="expander-1849441004" class="expand-container"><div id="expander-control-1849441004" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">2nd method</span></div><div id="expander-content-1849441004" class="expand-content"><ol><li><p>Go to MapProxy GetCapabilities XML response again.</p></li></ol><p>As we can see &lt;Layer&gt;&lt;/Layer&gt; elements includes the exactly WMTS URL template inside the:</p><p><code>&lt;ResourceURL/&gt;</code> element.</p><p>In my case for example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: xml; gutter: false; theme: Confluence" data-theme="Confluence">&lt;ResourceURL format=&quot;image/png&quot; resourceType=&quot;tile&quot; template=&quot;http://mapproxy-map-proxy-example/wmts/osm/{TileMatrixSet}/{TileMatrix}/{TileCol}/{TileRow}.png&quot;/&gt;</pre>
</div></div><p>Extract only the template attribute value so you get:</p><p><code>http://mapproxy-map-proxy-example/wmts/osm/{TileMatrixSet}/{TileMatrix}/{TileCol}/{TileRow}.png</code></p><p>and this is will use you as WMTS URL in order to consume LAYER layer later.</p><p /></div></div><p>After we understand and got our WMTS URL for our product, lets move on to application side and consume our product layer.</p><hr/><p><strong><u>Step 5:</u></strong></p><p>Now, after you got all <strong>product metadata</strong> that you need by querying our Catalog and MapProxy capabilities, lets actually use it in order to display it in real map viewer / application (clients).</p><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Below examples are based on <strong>Pseudo code</strong>, you will have to adapt it in your own application to make it work.</p></div></div><h3 id="Raster:GetStarted-LetsstartwithCesium:">Lets start with <strong>Cesium</strong>:</h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
...
...

const libotLayer = new Cesium.WebMapTileServiceImageryProvider({
      url : &#39;&lt;LAYER_WMTS_URL&gt;&#39;,
      layer : &#39;&lt;LAYER_PRODUCT_ID&gt;&#39;,
      style : &#39;&lt;LAYER_STYLE&gt;&#39;,
      format : &#39;&lt;LAYER_FORMAT&gt;&#39;,
      tileMatrixSetID : &#39;&lt;LAYER_TILE_MATRIX_SET_ID&gt;&#39;,
      /*********************************************************************************/
      /********     TILING SHEME SHOULD BE 2 x 1                                ********/
      /*********************************************************************************/
      tilingScheme: new Cesium.GeographicTilingScheme(),
      /*********************************************************************************/
      /********     EXTENT SHOULD BE AS MUCH AS CLOSE TO LAYER ORIGIN FOOTPRINT ********/
      /*********************************************************************************/
      rectangle : &lt;LAYER_EXTENT&gt;,
    });   
    
map.addLayer(libotLayer);
...
...
...</pre>
</div></div><p>Ok, now what? replace all &lt;&gt; place holders with the real values that we got from all previous steps:</p><ul><li><p><code>url</code> - should be replaced by the URL that you got from <strong>Step 4</strong>.</p><p> <code>/{TileMatrixSet}/{TileMatrix}/{TileCol}/{TileRow}.png</code> stays as is.</p></li><li><p><code>layer</code> -  should be replaced with layer Product ID.</p></li><li><p><code>style</code> - should be replaced with the value that you got from <strong>Step 3</strong>.</p></li><li><p><code>format</code> - should be replaced with the value that you got from <strong>Step 3</strong>.</p></li><li><p><code>tileMatrixSetID</code> - how can you get it? from Response from <strong>Step 3</strong>:</p><p><strong>just for example, in my case</strong> my layer contain the next TileMatrixSet:</p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" width="306" loading="lazy" src="attachments/1690501187/1690796063.png?width=306" data-image-src="attachments/1690501187/1690796063.png" data-height="53" data-width="391" data-unresolved-comment-count="0" data-linked-resource-id="1690796063" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="TilesMatrixSetLink.png" data-base-url="wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="1690501187" data-linked-resource-container-version="4" data-media-id="dfff6eba-3402-4057-b464-b019cb5b8123" data-media-type="file"></span><p /></li><li><p><code>rectangle</code> - value should be the BBOX (extent) that you got from <strong>Step 2</strong>.</p></li></ul><h3 id="Raster:GetStarted-NowwithOpenLayers:"><strong>Now with OpenLayers:</strong></h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
...
...
    
    const libotLayer = new TileLayer({
          opacity: 1,
          extent: &lt;LAYER_EXTENT&gt;
          source: new WMTS({
            name: &quot;&lt;LAYER_PRODUCT_ID&gt;&quot;,
            url: &lt;LAYER_WMTS_URL&gt;,
            layer: &lt;LAYER_PRODUCT_ID&gt;,
            matrixSet: &#39;&lt;LAYER_TILE_MATRIX_SET_ID&gt;&#39;,
            format: &#39;&lt;LAYER_FORMAT&gt;&#39;,
            isBaseLayer: true,
            style: &#39;&lt;LAYER_STYLE&gt;&#39;,
            requestEncoding: &#39;REST&#39;
          }),
    }),
    
    map.addLayer(libotLayer)
...
...
...</pre>
</div></div><ul><li><p><code>extent</code> - value should be the BBOX (extent) that you got from <strong>Step 2.</strong></p></li><li><p><code>url</code> - should be replaced by the url that you got from <strong>Step 4</strong>.</p></li><li><p><code>layer</code> -  should be replaced with layer Product ID</p></li><li><p><code>matrixSetID</code> - how can you get it? from the Response from <strong>Step 3</strong>:</p><p><strong>just for example, in my case</strong> my layer contain the next TileMatrixSet:</p></li></ul><span class="confluence-embedded-file-wrapper image-left-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-left" width="306" loading="lazy" src="attachments/1690501187/1690796063.png?width=306" data-image-src="attachments/1690501187/1690796063.png" data-height="53" data-width="391" data-unresolved-comment-count="0" data-linked-resource-id="1690796063" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="TilesMatrixSetLink.png" data-base-url="wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="1690501187" data-linked-resource-container-version="4" data-media-id="dfff6eba-3402-4057-b464-b019cb5b8123" data-media-type="file"></span><ul><li><p><code>style</code> - should be replaced with the value that you got from <strong>Step 3</strong>.</p></li><li><p><code>format</code> - should be replaced with the value that you got from <strong>Step 3</strong>.</p></li></ul><p><strong><u>Step 6:</u></strong></p><p>In order to present catalog items in your system you can use following fields:</p><ul><li><p><em><strong>mc:productName</strong></em></p></li><li><p><em><strong>mc:description</strong></em></p></li><li><p><em><strong>mc:links</strong></em> (treatment/parsing rules described above in <em>step 5</em>)</p></li></ul><p>Obviously, you can use rest of available fields as mentioned in <a href="1690763621.html" rel="nofollow">Raster profile definition </a></p><hr/><h6 style="text-align: center;" id="Raster:GetStarted-That&#39;sit,seeUsageTipsformoreinformationandtips."><strong>That's</strong> <strong>it</strong>, see <a href="Usage-Tips_1688731664.html" data-linked-resource-id="1688731664" data-linked-resource-version="17" data-linked-resource-type="page">Usage Tips</a>  for more information and tips.</h6>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1690501187/1690796050.xml">GetRecordsResponse.xml</a> (application/xml)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1690501187/1690796057.png">GetCabailities_Mapproxy_example.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1690501187/1690796069.png">TilesMatrixSetLink.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1690501187/1690796063.png">TilesMatrixSetLink.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Mar 16, 2022 12:17</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
